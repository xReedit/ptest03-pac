<div class="animated fadeIn p-3 content-body">

    <mat-tab-group mat-stretch-tabs (selectedTabChange)="tabSelected($event)">
        <mat-tab label="Pedidos"> 
            
            <div class="p-3">
                <div class="d-flex justify-content-between">
                    <div class="">
                        <h6>Pedidos Total {{ countPedidos }}</h6>
                        <div class="d-flex align-items-lg-end"> 
                            <div class="d-flex">
                                <div>
                                    <div class="d-flex">
                                        <p class="badge badge-success"> APP {{ countPedidosApp }}</p>
                                        <p class="badge badge-info ml-2"> TARJETA {{ countPedidosPagoTarjeta }}</p>
                                    </div>
                                    <div class="d-flex align-items-lg-end">
                                        <p class="badge badge-primary"> YAPE {{ countPedidosPagoYape }}</p>
                                        <!-- sistemas operativos -->
                                        <div>
                                            <p class="badge badge-success ml-2"> <i class="fa fa-android"></i> {{ countPedidosAndroid }}</p>
                                            <p class="badge badge-warning ml-2"> <i class="fa fa-apple"></i> {{ countPedidosIphone }}</p>
                                            <p class="badge badge-secondary ml-2"> <i class="fa fa-windows"></i> {{ countPedidosWindos }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            

                            <!-- pedidos mandados -->
                            <div class="d-flex xCursor w-25">
                                <div>
                                    <p class="badge badge-success ml-2 animated" [ngClass]="{'shakeX': isPedidosMandadosNotify}" (click)="isShowPedidosExpress = true;"> <i class="fa fa-motorcycle"></i> 
                                        Express
                                        <span class="pl-2"> {{ countPedidoMandados }} </span>
                                    </p>                                
                                </div>
                                <div>
                                    <p class="badge badge-warning ml-2 animated" [ngClass]="{'shakeX': isPedidosMandadosNotify}" (click)="isShowPedidoRetirosEntregados = true;"> 
                                        <i class="fa fa-credit-card"></i> 
                                        Cash Atm 
                                        <span class="pl-2"> {{ countPedidoRetirosAtm }} </span>
                                    </p>                                
                                </div>
                            </div>
                        </div>

                        <!-- pago de servicios pendiente de modificar -->
                        <div *ngIf="isShowNotificacionRestobar">
                            <p class="badge badge-danger animated pulse infinite xCursor" (click)="goPagoServicioConfirmar()"> Confirmar pago servicio <i class="fa fa-bank"></i></p>
                        </div>
                    </div>                    
                    <div class="d-flex align-items-center">
                        <!-- <button class="btn btn-sm btn-success mr-2" [ngClass]="{'btn-success': isClimaVisible, 'btn-secondary': '!isClimaVisible'}" (click)="isClimaVisible = !isClimaVisible"><i class="fa fa-refresh"></i><p class="fs-8 m-0">Clima</p></button> -->
                        <button class="btn btn-sm btn-success mr-2" (click)="loadPedidos()"><i class="fa fa-refresh"></i></button>
                        <app-com-date-filter (RangeSelected)="dateRangeSelected($event)"></app-com-date-filter>
                    </div>
                </div>

                <hr>

                <div *ngIf="countPedidoRetirosAtm > 0 && !isShowPedidoRetirosEntregados">                    
                    <table class="table-model-1 w-100" mat-table [dataSource]="dataRetirosCashAtm">
                        <ng-container matColumnDef="#">
                            <th mat-header-cell *matHeaderCellDef>#</th>
                            <td mat-cell *matCellDef="let element">
                                <p class="fw-600"> 
                                    {{ element.idatm_retiros}} 
                                    <span class="fw-600 fs-15 badge badge-warning"> Cash Atm</span>
                                </p>                            
                                <p>{{ element.fecha_hora}}</p>                                                                
                            </td>
                        </ng-container>
                        
                        <ng-container matColumnDef="cliente">
                            <th mat-header-cell *matHeaderCellDef>Cliente</th>
                            <td mat-cell *matCellDef="let element">
                                <p class="fw-600">{{ element.json_entrega.cliente.nombres}}</p>
                                <p>{{ element.json_entrega.cliente.telefono}}</p>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="ciudad">
                            <th mat-header-cell *matHeaderCellDef>Ciudad</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.json_entrega.direccion.ciudad}}</p>                                                                         
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="direccion">
                            <th mat-header-cell *matHeaderCellDef>Direccion</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.json_entrega.direccion.direccion}}</p>                                
                                <p>{{ element.json_entrega.direccion.referencia}}</p>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="importe">
                            <th mat-header-cell *matHeaderCellDef align="right">Importe</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <p class="fw-600">{{ element.importe_solicita | number : '.2'}}</p>                                
                                <p class="badge badge-info">Tarjeta</p>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="repartidor">
                            <th mat-header-cell *matHeaderCellDef>Repartidor</th>
                            <td mat-cell *matCellDef="let element">
                                <p class="fw-600 text-success">{{ element.nom_repartidor}}</p>                                                                
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="tiempo">
                            <th mat-header-cell *matHeaderCellDef align="right">M. Transcurridos</th>
                            <td mat-cell *matCellDef="let element" align="right">                                
                                <ng-container *ngIf="element.pwa_estado === 'E'; else elseTemplate">
                                    <span class="fw-600 text-success">Entregado</span>
                                </ng-container>
                                <ng-template #elseTemplate>
                                    <span class="fw-600">En proceso {{ element.min_transcurridos}} min</span>
                                </ng-template>                                                         
                                <button class="p-1" (click)="verPedidoRetiroAtm(element)">Ver pedido</button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumnsRetiroCashAtm"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumnsRetiroCashAtm;"></tr>
                    </table>
                    <br>
                </div>


                <!-- pedidos mandados y express -->

                <div *ngIf="countPedidoMandados > 0 || isShowPedidosExpress">
                    <button *ngIf="isShowPedidosExpress" mat-flat-button color="primary" (click)="isShowPedidosExpress = false;"><i class="fa fa-arrow-left"></i>   Atras</button>
                    <table *ngIf="dataPedidosMandados" class="table-model-1 w-100" mat-table [dataSource]="dataPedidosMandados">      
        
                        <ng-container matColumnDef="num_pedido">
                            <th mat-header-cell *matHeaderCellDef>#</th>
                            <td mat-cell *matCellDef="let element">
                                <p class="fw-600"> <span class="fw-600">Pedido Express</span> {{ element.idpedido_mandado}}</p>                            
                                <p>{{ element.fecha_hora}}</p>                            
                            </td>
                        </ng-container>
                        
        
                        <ng-container matColumnDef="ciudad">
                            <th mat-header-cell *matHeaderCellDef>Ciudad</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.ciudad}}</p>   
                                <div class="d-flex align-items-center">
                                    <p class="badge badge-success mr-2">
                                        APP
                                    </p>   
                                    <div>
                                        <p class="text-success" *ngIf="element.pedido_json.systemOS === 'Android'"><i class="fa fa-android"></i></p>                                              
                                        <p class="text-warning" *ngIf="element.pedido_json.systemOS === 'iOS'"><i class="fa fa-apple"></i></p>
                                        <p class="text-secondary" *ngIf="element.pedido_json.systemOS === 'Windows'"><i class="fa fa-windows"></i></p>
                                    </div>
                               </div>                                       
                            </td>
                        </ng-container>
        
                        <ng-container matColumnDef="cliente">
                            <th mat-header-cell *matHeaderCellDef>Cliente</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.nom_cliente}}</p>                                          
                                <p>{{ element.pedido_json.telefono}}</p>
                            </td>
                        </ng-container>
    
                        <ng-container matColumnDef="de">
                            <th mat-header-cell *matHeaderCellDef >Desde</th>
                            <td mat-cell *matCellDef="let element" style="max-width: 80px;">
                                <ng-container *ngIf="element.ispedido_express === 0; else elseTemplate">                                
                                    <span class="fw-100">{{ element.pedido_json.donde_compramos }}</span>                            
                                </ng-container>
                                <ng-template #elseTemplate>
                                    <span>{{ element.pedido_json.direccionA.direccion }}</span>
                                    <span class="text-secondary">{{ element.pedido_json.direccionA.referencia }}</span>
                                </ng-template>
                                
                            </td>
                        </ng-container>
    
                        <ng-container matColumnDef="a">
                            <th mat-header-cell *matHeaderCellDef >Entrega</th>
                            <td mat-cell *matCellDef="let element" style="max-width: 80px;">
                                <ng-container *ngIf="element.ispedido_express === 0; else elseTemplate">                                
                                    <span class="fw-100">{{ element.pedido_json.direccionCliente.direccion }}</span>                            
                                    <span class="text-secondary">{{ element.pedido_json.direccionCliente.referencia }}</span>
                                </ng-container>
                                <ng-template #elseTemplate>
                                    <span>{{ element.pedido_json.direccionB.direccion }}</span>
                                    <span class="text-secondary">{{ element.pedido_json.direccionB.referencia }}</span>
                                </ng-template>
                                
                            </td>
                        </ng-container>
    
                        <!-- <ng-container matColumnDef="vehiculo">
                            <th mat-header-cell *matHeaderCellDef >Vehiculo</th>
                            <td mat-cell *matCellDef="let element">
                                <span class="fw-600">{{ element.pedido_json.vehiculo.descripcion }}</span>                            
                            </td>
                        </ng-container> -->
    
                        <ng-container matColumnDef="repartidor">
                            <th mat-header-cell *matHeaderCellDef >Repartidor</th>
                            <td mat-cell *matCellDef="let element">
                                <span class="fw-600 text-success">{{ element.nom_repartidor }}</span>
                                <p>{{ element.telefono_repartidor}}</p>
                            </td>
                        </ng-container>
    
                        <ng-container matColumnDef="descripcion">
                            <th mat-header-cell *matHeaderCellDef>Pedido</th>
                            <td mat-cell *matCellDef="let element" style="max-width: 100px;">                            
                                <ng-container *ngIf="element.ispedido_express === 0; else elseTemplate">                                
                                    <span class="fs-12">                                
                                        {{ element.pedido_json.que_compramos }}
                                    </span>
                                </ng-container>
                                <ng-template #elseTemplate>
                                    <span class="fs-12">                                
                                        {{ element.pedido_json.descripcion_paquete }}
                                    </span>
                                </ng-template>
                                
                            </td>
                        </ng-container>
                        
                        <ng-container matColumnDef="importe">
                            <th mat-header-cell *matHeaderCellDef class="text-right">Imp. Total</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <p class="fw-600">{{ element.pedido_json.importe_pagar | number: '.2'}}</p>
                                <p class="fw-600 badge" [ngClass]="{'badge-primary': element.pedido_json.metodoPago.idtipo_pago === 3, 'badge-info': element.pedido_json.metodoPago.idtipo_pago === 2, 'badge-secondary': element.pedido_json.metodoPago.idtipo_pago === 1}">
                                    {{element.pedido_json.metodoPago.descripcion | titlecase }} 
                                </p> 
                            </td>
                        </ng-container>
                        
                        <ng-container matColumnDef="min_transcurridos">
                            <th mat-header-cell *matHeaderCellDef class="text-right">M. Transcurridos</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <span class="fw-600" *ngIf="!element.idrepartidor">{{ element.min_transcurridos }}</span>
                                <span *ngIf="element.pwa_estado == 'E'" class="fw-600 text-success">Entregado</span>
                                <br>
                                <button class="p-1" (click)="verPedidoExpress(element)">Ver pedido</button>
                            </td>
                        </ng-container>
        
                        <tr mat-header-row *matHeaderRowDef="displayedColumnsPedidosMandados"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumnsPedidosMandados;"></tr>
                    </table>                
                    </div>

                <!-- pedidos retiros cash entregados -->

                <div *ngIf="isShowPedidoRetirosEntregados">  
                    <button mat-flat-button color="primary" (click)="isShowPedidoRetirosEntregados = false;"><i class="fa fa-arrow-left"></i>   Atras</button>

                    <table class="table-model-1 w-100" mat-table [dataSource]="dataRetirosCashAtmEntregados">
                        <ng-container matColumnDef="#">
                            <th mat-header-cell *matHeaderCellDef>#</th>
                            <td mat-cell *matCellDef="let element">
                                <p class="fw-600"> 
                                    {{ element.idatm_retiros}} 
                                    <span class="fw-600 fs-15 badge badge-warning"> Cash Atm</span>
                                </p>                            
                                <p>{{ element.fecha_hora}}</p>                                                                
                            </td>
                        </ng-container>
                        
                        <ng-container matColumnDef="cliente">
                            <th mat-header-cell *matHeaderCellDef>Cliente</th>
                            <td mat-cell *matCellDef="let element">
                                <p class="fw-600">{{ element.json_entrega.cliente.nombres}}</p>
                                <p>{{ element.json_entrega.cliente.telefono}}</p>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="ciudad">
                            <th mat-header-cell *matHeaderCellDef>Ciudad</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.json_entrega.direccion.ciudad}}</p>                                                                         
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="direccion">
                            <th mat-header-cell *matHeaderCellDef>Direccion</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.json_entrega.direccion.direccion}}</p>                                
                                <p>{{ element.json_entrega.direccion.referencia}}</p>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="importe">
                            <th mat-header-cell *matHeaderCellDef align="right">Importe</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <p class="fw-600">{{ element.importe_solicita | number : '.2'}}</p>                                
                                <p class="badge badge-info">Tarjeta</p>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="repartidor">
                            <th mat-header-cell *matHeaderCellDef>Repartidor</th>
                            <td mat-cell *matCellDef="let element">
                                <p class="fw-600 text-success">{{ element.nom_repartidor}}</p>                                                                
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="tiempo">
                            <th mat-header-cell *matHeaderCellDef align="right">M. Transcurridos</th>
                            <td mat-cell *matCellDef="let element" align="right">                                
                                <span class="fw-600 text-success">Entregado</span>
                                <!-- <button class="p-1" (click)="verPedidoRetiroAtm(element)">Ver pedido</button> -->
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumnsRetiroCashAtm"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumnsRetiroCashAtm;"></tr>
                    </table>
                    <br>
                </div>
                
                <div *ngIf="!isShowPedidosExpress && !isShowPedidoRetirosEntregados">

                

                    <table *ngIf="dataPedidos" class="table-model-1 w-100" mat-table [dataSource]="dataPedidos">      
        
                        <ng-container matColumnDef="num_pedido">
                            <th mat-header-cell *matHeaderCellDef>Pedido</th>
                            <td mat-cell *matCellDef="let element">
                                <p class="fw-600">{{ element.idpedido}}</p>                            
                                <p>{{ element.fecha}} {{ element.hora}}</p>
                                <span class="fw-600 badge" [ngClass]="{'badge-secondary': element.pwa_estado === 'P', 'badge-success': element.pwa_estado != 'P'}">
                                    <span *ngIf="element.pwa_estado !== 'P'">Visto</span>
                                    <span *ngIf="element.pwa_estado === 'P'">No visto</span>
                                </span>
                                <span *ngIf="element.json_datos_delivery.p_header.arrDatosDelivery.pasoRecoger" class="fw-600 badge badge-warning" >
                                    <span><i class="fa fa-user"></i>Recoje cliente</span>
                                </span>
                            </td>
                        </ng-container>
        
                        <ng-container matColumnDef="comercio">
                            <th mat-header-cell *matHeaderCellDef>Comercio</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.nom_sede}}</p>                                          
                                <p>{{ element.dir_sede}}</p>
                                <div class="d-flex align-items-center">
                                    <p *ngIf="element.json_datos_delivery.p_header.isCliente === 1" class="badge badge-success mr-2">
                                        APP
                                    </p>   
                                    <div>
                                        <p class="text-success" *ngIf="element.json_datos_delivery.p_header.systemOS === 'Android'"><i class="fa fa-android"></i></p>                                              
                                        <p class="text-warning" *ngIf="element.json_datos_delivery.p_header.systemOS === 'iOS'"><i class="fa fa-apple"></i></p>
                                        <p class="text-secondary" *ngIf="element.json_datos_delivery.p_header.systemOS === 'Windows'"><i class="fa fa-windows"></i></p>
                                    </div>
                                </div>
                            </td>
                        </ng-container>
        
                        <ng-container matColumnDef="ciudad">
                            <th mat-header-cell *matHeaderCellDef>Ciudad</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.ciudad_sede}}</p>   
                                <ng-container *ngIf="element.pwa_delivery_servicio_propio === 1; else elseTemplate">
                                <span class="badge badge-info">Propio reparto</span>
                                </ng-container>
                                <ng-template #elseTemplate>
                                    <span class="badge badge-success">red repartidores</span>
                                </ng-template>
                                        
                            </td>
                        </ng-container>
        
                        <ng-container matColumnDef="cliente">
                            <th mat-header-cell *matHeaderCellDef>Cliente</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.nom_cliente}}</p>              
                                <p>{{ element.json_datos_delivery.p_header.arrDatosDelivery.direccion}}</p>
                                <p>{{ element.json_datos_delivery.p_header.arrDatosDelivery.telefono}}</p>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="repartidor">
                            <th mat-header-cell *matHeaderCellDef >Repartidor</th>
                            <td mat-cell *matCellDef="let element">
                                <span class="fw-600 text-success">{{ element.nom_repartidor }}</span>
                                <p>{{ element.telefono_repartidor}}</p>
                            </td>
                        </ng-container>

                        
                        <ng-container matColumnDef="importe">
                            <th mat-header-cell *matHeaderCellDef class="text-right">Imp. Total</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <p class="fw-600">{{ element.total_r }}</p>
                                <p class="fw-600 badge" [ngClass]="{'badge-primary': element.json_datos_delivery.p_header.arrDatosDelivery.metodoPago.idtipo_pago === 3, 'badge-info': element.json_datos_delivery.p_header.arrDatosDelivery.metodoPago.idtipo_pago === 2, 'badge-secondary': element.json_datos_delivery.p_header.arrDatosDelivery.metodoPago.idtipo_pago === 1}">
                                    {{element.json_datos_delivery.p_header.arrDatosDelivery.metodoPago.descripcion | titlecase }} 
                                </p> 
                            </td>
                        </ng-container>
                        
                        <ng-container matColumnDef="min_transcurridos">
                            <th mat-header-cell *matHeaderCellDef class="text-right">M. Transcurridos</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <span class="fw-600" *ngIf="!element.idrepartidor">{{ element.min_transcurridos }}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="min_avisa">
                            <th mat-header-cell *matHeaderCellDef class="text-right">M. Avisa</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <span class="fw-600" *ngIf="!element.idrepartidor">{{ element.pwa_min_despacho }}</span>
                                <div *ngIf="element.idrepartidor">
                                    <ng-container *ngIf="element.pwa_delivery_status === '4'; else elseTemplate">
                                        <span class="fw-600 text-success">Entregado</span>
                                        <p class="fw-600" [ngClass]="{'text-success': element.pwa_delivery_tiempo_atendido <= 30, 'text-danger': element.pwa_delivery_tiempo_atendido > 30}">{{element.pwa_delivery_tiempo_atendido}} min</p>
                                    </ng-container>
                                    <ng-template #elseTemplate>
                                        <span class="fw-600">En proceso</span>
                                    </ng-template>
                                    
                                </div>
                                <br>
                                <button class="p-1" (click)="verPedido(element)">Ver pedido</button>
                            </td>
                        </ng-container>
        
                        <tr mat-header-row *matHeaderRowDef="displayedColumnsPedidos"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumnsPedidos;"></tr>
                    </table>
                    <!-- <mat-paginator [pageSizeOptions]="[20, 40, 60]" [hidePageSize]="true" showFirstLastButtons></mat-paginator> -->
                
                </div>


                



            </div>

            <br><br>

            <!-- footer clima -->
            <!-- <div class="x-footer-clima p-2 animated d-flex" [ngClass]="{'h-min': !isClimaVisible, 'fadeInUp': isClimaVisible, 'fadeOutDown': !isClimaVisible}">                
                <app-comp-clima></app-comp-clima>                
            </div> -->

        </mat-tab>
        






        <!-- repartidores -->
        <mat-tab label="Repartidores"> 
            <div class="p-3">                
                <h5>Repartidores</h5>
                <button class="btn btn-info" (click)="loadRepartidores()" [disabled]="loaderRepartidores">
                    <ng-container *ngIf="loaderRepartidores; else elseTemplateTitleBtnUpdate">
                        <i class="fa fa-spinner fa-spin"></i>
                    </ng-container>
                    <ng-template #elseTemplateTitleBtnUpdate>
                        Actualizar
                    </ng-template>                                        
                </button>
                <button class="btn btn-warning ml-2" [ngClass]="{'bg-secondary': !showRepartidorMapa}" (click)="showRepartidorMapa = !showRepartidorMapa"><i class="fa fa-map"></i>  Ver Mapa</button>
                <hr>

                <div *ngIf="listPedidosPendientes">
                    <h6>Pedidos pendientes  ({{  listPedidosPendientes.length }})</h6>
                    <!-- pedidos pendientes por atender -->
                    <div class="d-flex" style="height: 100px; background: #eceff1; border-radius: 5px;">
                        <div *ngFor="let element of listPedidosPendientes" class="xCursor fs-12 border p-3 text-center m-2 bg-white" style="border-radius: 5px;" (click)="verPedido(element.elpedido)">
                            <p>{{ element.sede}}</p>   
                            <p>
                                <ng-container *ngIf="element.elpedido.flag_is_cliente===1; else elseTemplateIsNotApp">
                                    <span class="badge badge-success">APP</span>
                                </ng-container>
                                <ng-template #elseTemplateIsNotApp>
                                    pedido :
                                </ng-template>
                                                                
                                {{ element.pedido }}
                            </p>
                            <p class="fw-600 text-secondary" [ngClass]="{'text-danger': element.tiempo > 20}">{{ element.tiempo }} Min</p>
                            <p class="fs-11 badge badge-info" *ngIf="element.solicito_repartidor == 1">Solicita Repartidor</p>
                        </div>
                    </div>
                </div>


                <hr>
            

                <div *ngIf="showRepartidorMapa">
                    <h5>Repartidor en el mapa</h5>        
                    <app-mapa-repartidores-pedidos [listpedidos]="listPPendienteSocket"></app-mapa-repartidores-pedidos>
                    <hr>
                </div>
                        

                <!-- lista -->
                <table *ngIf="dataRepartidores" class="table-model-1 w-100" mat-table [dataSource]="dataRepartidores">      
    
                    <ng-container matColumnDef="repartidor">
                        <th mat-header-cell *matHeaderCellDef>Repartidor</th>
                        <td mat-cell *matCellDef="let element">
                            <p class="fw-600 fs-11">{{ element.nombre}}  {{ element.apellido}} | <span><i class="fa fa-star text-warning"></i> {{ element.calificacion}}</span></p>                            
                            <span class="fs-11">{{ element.idrepartidor}}</span>
                            <span class="fs-11">| {{ element.telefono}}</span>
                            <span class="fs-11"> | {{ element.ciudad | titlecase}}</span><br>
                            <p *ngIf="element.online === 1">Efectivo: <span class="fw-600">{{element.efectivo_mano | number: '.2'}}</span></p>
                            
                            <div>
                                <ng-container *ngIf="element.idsede_suscrito; else elseTemplate">
                                    <p class="badge badge-secondary mr-1"> Propio</p>
                                </ng-container>
                                <ng-template #elseTemplate>
                                    <p class="badge badge-info mr-1"> Red Rerpartidor </p>                                     
                                </ng-template>                            

                                <!-- online -->
                                <ng-container *ngIf="element.online === 1; else elseTemplateOnLine">
                                    <span class="badge badge-success">Conectado</span>
                                </ng-container>
                                <ng-template #elseTemplateOnLine>
                                    <span class="badge badge-secondary">Off</span>
                                </ng-template>

                            </div>
                        </td>
                    </ng-container>

                    <!-- pedido en marcha -->
                    <ng-container matColumnDef="pedido_a">
                        <th mat-header-cell *matHeaderCellDef class="text-left" style="min-width: 350px;">P. Aceptado</th>
                        <td mat-cell *matCellDef="let element">
                            <!-- <div *ngIf="element.r_idpedido" class="text-center">
                                <span>{{ element.nom_sede}}</span>                                              
                                <p class="fw-600 text-success">{{ element.r_idpedido }}</p>   
                                <p class="fw-600 text-secondary" [ngClass]="{'text-danger': element.t_transcurrido > 20}">{{ element.t_transcurrido }} Min</p>           
                            </div> -->

                            <ng-container *ngIf="element.ocupado ===  1; else elseTemplateLibre">
                                <div style="max-height: 90px; overflow: auto;">
                                    <table class="table-row-mouse">
                                        <tr *ngFor="let p of element.show_pedidos_aceptados" class="fs-11 border-bottom-t-asignado" (click)="verPedidoById(p.idpedido)">
                                            <td style="width: 120px;"><span class="fw-600">
                                                {{p.idpedido}}</span>  <span> {{p.establecimiento | titlecase}}</span>
                                                <span *ngIf="p.flag_is_cliente === 1" class="badge badge-sm badge-success fw-100 ml-1 fs-8">APP</span>
                                            </td>
                                            <td>
                                                <ng-container *ngIf="p?.pwa_estado === 'E'; else elseTemplateAunNoEntregado">
                                                    <span class="fw-600" [ngClass]="{'text-success': p.pwa_delivery_tiempo_atendido <= 30, 'text-danger': p.pwa_delivery_tiempo_atendido > 30}">{{p.pwa_delivery_tiempo_atendido}} min</span>
                                                </ng-container>
                                                <ng-template #elseTemplateAunNoEntregado>
                                                    <span class="text-secondary ml-1 fw-600" [ngClass]="{'text-danger': p.t_transcurrido > 20}">{{ p.t_transcurrido }} Min </span>
                                                </ng-template>                                                                                                                                
                                            </td>
                                            <td>
                                                <span class="text-secondary ml-1" [ngClass]="{'text-success fw-600': p?.time_line?.llego_al_comercio}">Llego</span>
                                                <span class="text-secondary" [ngClass]="{'text-success fw-600': p?.time_line?.en_camino_al_cliente}">->En Camino</span>
                                                <span class="text-secondary" [ngClass]="{'text-success fw-600': p?.pwa_estado === 'E'}">->Entrego</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </ng-container>
                            <ng-template #elseTemplateLibre>                                

                                <!-- notificando -->
                                <ng-container *ngIf="element.pedido_por_aceptar; else elseTemplateNotificandoLibre">
                                    <!-- <div *ngIf="element.flag_paso_pedido > 0">                                         -->
                                            <p class="badge badge-primary fw-100">Notificando</p>
                                            <p>{{ element.nom_sede}}</p>                                              
                                            <p class="fw-100 fs-11">
                                                {{ element.pedido_por_aceptar.pedidos }}
                                                <span class="text-secondary fw-600 ml-1" [ngClass]="{'text-danger': element.t_transcurrido > 20}">{{ element.t_transcurrido }} Min</span>
                                            </p>
                                            
                                    <!-- </div> -->
                                </ng-container>
                                <ng-template #elseTemplateNotificandoLibre>
                                    <p *ngIf="element.online === 1" class="fw-100 fs-18 text-secondary">Libre</p>
                                </ng-template>
                                

                            </ng-template>
                            

                            
                        </td>
                    </ng-container>

                    <!-- pedido por aceptar -->
                    <!-- <ng-container matColumnDef="por_aceptar">
                        <th mat-header-cell *matHeaderCellDef class="text-center">Por aceptar</th>
                        <td mat-cell *matCellDef="let element">
                            <div *ngIf="element.flag_paso_pedido > 0" class="text-center">
                                <span>{{ element.nom_sede}}</span>                                              
                                <p class="fw-600 text-danger">{{ element.flag_paso_pedido }}</p>
                                <p class="fw-600 text-secondary" [ngClass]="{'text-danger': element.t_transcurrido > 20}">{{ element.t_transcurrido }} Min</p>           
                            </div>

                            
                        </td>
                    </ng-container> -->

                    <!-- <ng-container matColumnDef="aceptados">
                        <th mat-header-cell *matHeaderCellDef class="text-center">Entregados</th>
                        <td mat-cell *matCellDef="let element" align="center">
                            <div class="text-center" *ngIf="!!element?.pedido_por_aceptar">
                                <p class="fs-12 fw-600">{{ element?.pedido_por_aceptar.cantidad_entregados }} de {{ element?.pedido_por_aceptar.cantidad_pedidos_aceptados | number: '2.' }}</p>
                                <p class="fs-11 text-secondary">Pedidos Entregados</p>
                            </div>
                        </td>
                    </ng-container>                                                      -->
                    
                    <!-- <ng-container matColumnDef="reasignado">
                        <th mat-header-cell *matHeaderCellDef class="text-right">P. Reasignados</th>
                        <td mat-cell *matCellDef="let element" align="right">
                            {{ element.pedidos_reasignados }}
                            <button class="ml-3 p-1" (click)="resetContadorRepartidor(element)">Reset</button>
                        </td>
                    </ng-container> -->

                    <ng-container matColumnDef="ocupado">
                        <th mat-header-cell *matHeaderCellDef class="text-right">Ocupado</th>
                        <td mat-cell *matCellDef="let element" align="right">
                            <ng-container *ngIf="element.ocupado === 1 || element.pedido_por_aceptar; else elseTemplate">
                                <span *ngIf="element.ocupado === 1" class="fw-600 text-success pr-2">Si</span>
                                <button class="p-1" (click)="resetLiberarRepartidor(element)">Liberar</button>
                            </ng-container>
                            <ng-template #elseTemplate>
                                <span>No</span>
                            </ng-template>  

                            <div *ngIf="element.pedidos_reasignados > 4">
                                <br>
                                <button class="ml-3 p-1" (click)="resetContadorRepartidor(element)">Reset {{ element.pedidos_reasignados }}</button>
                            </div>
                        </td>
                    </ng-container>
    
                    <tr mat-header-row *matHeaderRowDef="displayedColumnsRepartidor"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsRepartidor;"></tr>
                </table>
                <mat-paginator [pageSizeOptions]="[10, 20, 30]" [hidePageSize]="true" showFirstLastButtons #paginatorRepartidor></mat-paginator>
            </div>
        </mat-tab>  
        
        


        <!-- clientes -->
        <mat-tab label="Clientes"> 
            <div class="p-3">
                <h6>Clientes {{ countClientes }}</h6>
                <button  class="btn btn-info"  (click)="loadClientes()">Actualizar</button>

                <table *ngIf="dataClientes" class="table-model-1 w-100" mat-table [dataSource]="dataClientes">      
    
                    <ng-container matColumnDef="idcliente">
                        <th mat-header-cell *matHeaderCellDef>id</th>
                        <td mat-cell *matCellDef="let element">
                            <p class="fw-600">{{ element.idcliente}}</p>                                                        
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="cliente">
                        <th mat-header-cell *matHeaderCellDef>Nombres</th>
                        <td mat-cell *matCellDef="let element">
                            <p>{{ element.nombres}}</p>                                                                                              
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="pwa_id">
                        <th mat-header-cell *matHeaderCellDef>pwa_id</th>
                        <td mat-cell *matCellDef="let element">
                            <p>{{ element.pwa_id}}</p>              
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="f_registro">
                        <th mat-header-cell *matHeaderCellDef>f_registro</th>
                        <td mat-cell *matCellDef="let element">
                            <span class="fw-600">{{ element.f_registro }}</span>
                        </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="telefono">
                        <th mat-header-cell *matHeaderCellDef>telefono</th>
                        <td mat-cell *matCellDef="let element">
                            <span>{{ element.telefono }}</span>
                        </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="calificacion">
                        <th mat-header-cell *matHeaderCellDef>calificacion</th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.calificacion }}
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumnsCliente"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsCliente;"></tr>
                </table>
                <mat-paginator [pageSizeOptions]="[10, 20, 30]" [hidePageSize]="true" showFirstLastButtons #paginatorCliente></mat-paginator>

                

                <hr>

                <!-- Las veces que se escanea qr x local -->        
                <h4>Veces que se escanea QR. Uso del servicio mozo virtual x local</h4>
                <div>
                    <button  class="btn btn-info mr-2"  (click)="loadClientesScanQr(true)">Actualizar Hoy</button>
                    <button  class="btn btn-warning"  (click)="loadClientesScanQr(false)">Ver Total</button>
                </div>
                <br>

                <table *ngIf="dataClientesScanQr" class="table-model-1 w-100" mat-table [dataSource]="dataClientesScanQr">      
    
                    <ng-container matColumnDef="#">
                        <th mat-header-cell *matHeaderCellDef>num</th>
                        <td mat-cell *matCellDef="let element; let i = index;">
                            <p class="fw-600">{{ i + 1 }}</p>                                                        
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="Sede">
                        <th mat-header-cell *matHeaderCellDef>Local</th>
                        <td mat-cell *matCellDef="let element">
                            <p>{{ element.nombre}} | {{ element.ciudad}}</p>                                                                                              
                            <p class="text-secondary fs-10">{{ element.direccion}}</p>
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="Canal">
                        <th mat-header-cell *matHeaderCellDef>Canal de ventas</th>
                        <td mat-cell *matCellDef="let element">
                            <div *ngFor="let item of element.tipo_consumo">
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr);">
                                    <span>{{ item.cantidad }} {{ item.tipo_consuno }}</span>                                    
                                    <span>{{ item.importe | number: '.2' }}</span>
                                </div>
                            </div>              
                        </td> 
                    </ng-container>
    
                    <ng-container matColumnDef="cant_total">
                        <th mat-header-cell *matHeaderCellDef align="rigth">Total Escaneos</th>
                        <td align="right" mat-cell *matCellDef="let element">
                            <span class="fw-600">{{ element.cant }}</span>
                        </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="imp_total">
                        <th mat-header-cell *matHeaderCellDef align="rigth">Importe Generado</th>
                        <td align="right" mat-cell *matCellDef="let element">
                            <span class="fw-600">{{ element.importe | number:'.2' }}</span>
                        </td>
                    </ng-container>                    

                    <tr mat-header-row *matHeaderRowDef="displayedColumnsClienteScanQr"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsClienteScanQr;"></tr>
                </table>
                <mat-paginator [pageSizeOptions]="[10, 20, 30]" [hidePageSize]="true" showFirstLastButtons #paginatorClienteScanQr></mat-paginator>

                

                <hr>

                <!-- calificaciones a los comercios -->
                <h4>Calificaciones de los clientes a los comercios  
                    <span> {{ dataCalificacionComercio.data.length }} </span>
                </h4>
                <div>
                    <button  class="btn btn-info mr-2"  (click)="loadCalificacionClienteToComercio()">
                        Actualizar Calificaciones

                        <span *ngIf="dataCalificacionComercio.data.length === 0"> <i class="fa fa-spinner fa-spin"></i> </span>
                    </button>
                </div>

                <table *ngIf="dataCalificacionComercio" class="table-model-1 w-100" mat-table [dataSource]="dataCalificacionComercio">      
    
                    <ng-container matColumnDef="num_pedido">
                        <th mat-header-cell *matHeaderCellDef>Pedido</th>
                        <td mat-cell *matCellDef="let element">
                            <p class="fw-600">{{ element.idpedido}}</p>                            
                            <p>{{ element.fecha}} {{ element.hora}}</p>
                            <span class="fw-600 badge" [ngClass]="{'badge-secondary': element.pwa_estado === 'P', 'badge-success': element.pwa_estado != 'P'}">
                                <span *ngIf="element.pwa_estado !== 'P'">Visto</span>
                                <span *ngIf="element.pwa_estado === 'P'">No visto</span>
                            </span>
                            <span *ngIf="element?.json_datos_delivery?.p_header?.arrDatosDelivery.pasoRecoger" class="fw-600 badge badge-warning" >
                                <span><i class="fa fa-user"></i>Recoje cliente</span>
                            </span>
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="comercio">
                        <th mat-header-cell *matHeaderCellDef>Comercio</th>
                        <td mat-cell *matCellDef="let element">
                            <p>{{ element.nom_sede}}</p>                                          
                            <p>{{ element.dir_sede}}</p>
                            <div class="d-flex align-items-center">
                                <p *ngIf="element?.json_datos_delivery?.p_header?.isCliente === 1" class="badge badge-success mr-2">
                                    APP
                                </p>   
                                <div>
                                    <p class="text-success" *ngIf="element?.json_datos_delivery?.p_header?.systemOS === 'Android'"><i class="fa fa-android"></i></p>                                              
                                    <p class="text-warning" *ngIf="element?.json_datos_delivery?.p_header?.systemOS === 'iOS'"><i class="fa fa-apple"></i></p>
                                    <p class="text-secondary" *ngIf="element?.json_datos_delivery?.p_header?.systemOS === 'Windows'"><i class="fa fa-windows"></i></p>
                                </div>
                            </div>                                                                                              
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="ciudad">
                        <th mat-header-cell *matHeaderCellDef>Ciudad</th>
                        <td mat-cell *matCellDef="let element">
                            <p>{{ element.ciudad_sede}}</p>   
                            <ng-container *ngIf="element.pwa_delivery_servicio_propio === 1; else elseTemplate">
                            <span class="badge badge-info">Propio reparto</span>
                            </ng-container>
                            <ng-template #elseTemplate>
                                <span class="badge badge-success">red repartidores</span>
                            </ng-template>    
                        </td>
                    </ng-container>
    
                    <ng-container matColumnDef="cliente">
                        <th mat-header-cell *matHeaderCellDef>Cliente</th>
                        <td mat-cell *matCellDef="let element">
                            <p>{{ element.json_datos_delivery.p_header.arrDatosDelivery.nombre}}</p>              
                            <p>{{ element.json_datos_delivery.p_header.arrDatosDelivery.direccion}}</p>
                            <p>{{ element.json_datos_delivery.p_header.arrDatosDelivery.telefono}}</p>
                        </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="repartidor">
                        <th mat-header-cell *matHeaderCellDef>Repartidor</th>
                        <td mat-cell *matCellDef="let element">
                            <span class="fw-600 text-success">{{ element.nom_repartidor }}</span>
                            <p>{{ element.telefono_repartidor}}</p>
                        </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="calificacion">
                        <th mat-header-cell *matHeaderCellDef>Calificacion</th>
                        <td mat-cell *matCellDef="let element">
                            <span class="badge p-1" [ngClass]="{'badge-danger': element.style_calificacion === 0, 'badge-warning': element.style_calificacion === 1, 'badge-success': element.style_calificacion === 2}">
                                {{ element.calificacion_cliente }}
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="comentario">
                        <th mat-header-cell *matHeaderCellDef>Comentario</th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.comentario }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="opciones">
                        <th mat-header-cell *matHeaderCellDef>.</th>
                        <td mat-cell *matCellDef="let element">
                            <button class="p-1" (click)="verPedido(element)">Ver pedido</button>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumnsCalificacionComercio"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsCalificacionComercio;"></tr>
                </table>
                <mat-paginator [pageSizeOptions]="[10, 20, 30]" [hidePageSize]="true" showFirstLastButtons #paginatorCalificacion></mat-paginator>

            </div>
        </mat-tab>





        <mat-tab label="Pagos con Tarjeta"> 
            <div class="p-3" *ngIf="dataPedidosAbona">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>Pendientes de pagar ({{ countPedidosAbonar }})</h6>
                        <p class="fs-15">Pendiente Abonar S/.{{sumTotalAbona |  number : '.2'}}</p>
                    </div>
                    <div class="text-right">
                        <button  class="btn btn-warning mr-2"  (click)="exportPdf()"> <i class="fa fa-download"></i> PDF</button>
                        <button  class="btn btn-info"  (click)="verPedidoPagosVisa()">Actualizar</button>
                    </div>                
                </div>                                

                <hr>

                <div id="element-to-print">
                
                    <!-- filtros -->
                    <div class="d-flex justify-content-between">
                        <div>

                            <mat-form-field>
                                <mat-label>Por</mat-label>
                                <mat-select (selectionChange)="filtroPor($event.value)">
                                    <mat-option value="0"> COMERCIOS </mat-option>
                                    <mat-option value="1"> REPARTIDORES </mat-option>
                                </mat-select>
                            </mat-form-field>
    
                            <ng-container *ngIf="dataFiltroAbonar.por === '0'; else elseTemplate">
                                <!-- comercio -->
                                <mat-form-field>
                                    <mat-label>Comercio</mat-label>
                                    <mat-select (selectionChange)="filtroComercio($event)">
                                        <mat-option *ngFor="let item of listComercioPagar" [value]="item">
                                            {{item.nombre}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </ng-container>
    
                            <ng-template #elseTemplate>
                                
                                <!-- repartidor -->
                                <mat-form-field>
                                    <mat-label>Repartidor</mat-label>
                                    <mat-select (selectionChange)="filtroRepartidor($event)">
                                        <mat-option *ngFor="let item of listRepartidoresPagar" [value]="item">
                                            {{item.nombre}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
    
                            </ng-template>
                            
                        
    
                            <!-- abono -->
                            <mat-form-field>
                                <mat-label>Estado</mat-label>
                                <mat-select (selectionChange)="filtroAbonado($event.value)">
                                    <mat-option value="-1"> TODOS </mat-option>
                                    <mat-option value="1"> ABONADO </mat-option>
                                    <mat-option value="0"> POR ABONAR </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <!-- rango fecha -->
                        <div>
                            <app-com-date-filter (RangeSelected)="dateRangeAbonoSelected($event)"></app-com-date-filter>
                        </div>
                    </div>

                    <hr>
                    
                    <table *ngIf="dataPedidosAbona" class="table-model-1 w-100" mat-table [dataSource]="dataPedidosAbona">      
        
                        <ng-container matColumnDef="num_pedido">
                            <th mat-header-cell *matHeaderCellDef>Pedido</th>
                            <td mat-cell *matCellDef="let element">
                                <span class="xCursor fw-600 fs-16" (click)="verPedido(element)"> {{ element.idpedido}} </span>
                                <span class="ml-1 text-danger fs-10 fw-600" *ngIf="element.pwa_delivery_atendido === 1">No Atendido</span>
                                <!-- <bottom (click)="verPedido(element)"> {{ element.idpedido}} </a> -->
                                <!-- <button class="p-1" (click)="verPedido(element)"><p class="fw-600">{{ element.idpedido}}</p></button>                             -->
                                <p>{{ element.fecha}} {{ element.hora}}</p>                            
                            </td>
                            <td mat-footer-cell *matFooterCellDef> Totales </td>
                        </ng-container>
        
                        <ng-container matColumnDef="comercio">
                            <th mat-header-cell *matHeaderCellDef>Comercio</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.nom_sede}}</p>                                          
                                <p>{{ element.dir_sede}}</p>
                                <p *ngIf="element.json_datos_delivery.p_header.isCliente === 1" class="badge badge-success">
                                    APP
                                </p>                                                 
                            </td>
                            <td mat-footer-cell *matFooterCellDef> </td>
                        </ng-container>
        
                        <ng-container matColumnDef="ciudad">
                            <th mat-header-cell *matHeaderCellDef>Ciudad</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.ciudad_sede}}</p>   
                                <ng-container *ngIf="element.pwa_delivery_servicio_propio === 1; else elseTemplate">
                                <span class="badge badge-info">Propio reparto</span>
                                </ng-container>
                                <ng-template #elseTemplate>
                                    <span class="badge badge-success">red repartidores</span>
                                </ng-template>
                                        
                            </td>
                            <td mat-footer-cell *matFooterCellDef> </td>
                        </ng-container>
        
                        <ng-container matColumnDef="cliente">
                            <th mat-header-cell *matHeaderCellDef>Cliente</th>
                            <td mat-cell *matCellDef="let element">
                                <p>{{ element.nom_cliente}}</p>  
                                <p class="fw-600 badge" [ngClass]="{'badge-danger': element.canal_consumo === 'Delivery', 'badge-warning': element.canal_consumo === 'Local', 'badge-secondary': element.canal_consumo === 'LLevar'}">
                                    {{ element.canal_consumo }}
                                </p>            
                                
                                <!-- <p>{{ element.json_datos_delivery.p_header.arrDatosDelivery.direccion}}</p>
                                <p>{{ element.json_datos_delivery.p_header.arrDatosDelivery.telefono}}</p> -->
                            </td>
                            <td mat-footer-cell *matFooterCellDef> </td>
                        </ng-container>

                        <ng-container matColumnDef="repartidor">
                            <th mat-header-cell *matHeaderCellDef >Repartidor</th>
                            <td mat-cell *matCellDef="let element">
                                <span class="fw-600 text-success">{{ element.nom_repartidor }}</span>
                                <p>{{ element.telefono_repartidor}}</p>
                            </td>
                            <td mat-footer-cell *matFooterCellDef> </td>
                        </ng-container>

                        
                        <ng-container matColumnDef="importe">
                            <th mat-header-cell *matHeaderCellDef class="text-right">Imp. Transaccion</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <p class="fw-600">{{ element.total_r }}</p>
                                <!-- [ngClass]="{'badge-primary': element.json_datos_delivery.p_header.arrDatosDelivery.metodoPago.idtipo_pago === 3, 'badge-info': element.json_datos_delivery.p_header.arrDatosDelivery.metodoPago.idtipo_pago === 2, 'badge-secondary': element.json_datos_delivery.p_header.arrDatosDelivery.metodoPago.idtipo_pago === 1} -->                                
                            </td>
                            <td align="right" mat-footer-cell *matFooterCellDef> {{getTotalCostTotal() | number: '.2'}} </td>
                        </ng-container>

                        <ng-container matColumnDef="importe_debitar">
                            <th mat-header-cell *matHeaderCellDef class="text-right">Imp. Debitar </th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <p class="fw-600">{{ element.total_debitar | number:'.2' }}</p>                                
                                <p class="fw-600 badge badge-info">                                    
                                    Tarjeta
                                </p> 
                            </td>
                            <td align="right" mat-footer-cell *matFooterCellDef> {{getTotalCostTotalDebitar() | number: '.2'}} </td>
                        </ng-container>
                        
                        <ng-container matColumnDef="c_visa">
                            <th mat-header-cell *matHeaderCellDef class="text-right">c. visanet</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <span class="fw-600">{{ element.pp_arr.visa }}</span>                            
                            </td>
                            <td align="right" mat-footer-cell *matFooterCellDef> {{getTotalCostVisa() | number: '.2'}} </td>
                        </ng-container>

                        <ng-container matColumnDef="c_igv">
                            <th mat-header-cell *matHeaderCellDef class="text-right">c. igv</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <span class="fw-600">{{ element.pp_arr.igv }}</span>
                            </td>
                            <td align="right" mat-footer-cell *matFooterCellDef> {{getTotalCostIgv() | number: '.2'}} </td>
                        </ng-container>

                        <ng-container matColumnDef="c_transaccion">
                            <th mat-header-cell *matHeaderCellDef class="text-right">c. transaccion</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <span class="fw-600">{{ element.pp_arr.trasaccionalidad }}</span>
                            </td>
                            <td align="right" mat-footer-cell *matFooterCellDef> {{getTotalCostTra() | number: '.2'}} </td>
                        </ng-container>

                        <ng-container matColumnDef="c_entrega">
                            <th mat-header-cell *matHeaderCellDef class="text-right">c. entrega</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <span class="fw-600">{{ element.pp_repartidor | number: '.2' }}</span>
                            </td>
                            <td align="right" mat-footer-cell *matFooterCellDef> {{getTotalCostEntrega() | number: '.2'}} </td>
                        </ng-container>

                        <ng-container matColumnDef="neto_abonar">
                            <th mat-header-cell *matHeaderCellDef class="text-right">N. Abonar</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <span class="fw-600">{{ element.pp_arr.total }}</span>
                            </td>
                            <td align="right" mat-footer-cell *matFooterCellDef> {{getTotalCostAbono() | number: '.2'}} </td>
                        </ng-container>

                        <ng-container matColumnDef="action">
                            <th mat-header-cell *matHeaderCellDef class="text-right">Liquidado</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                <ng-container *ngIf="element.check_liquidado === '0' ; else elseTemplate">                                
                                    <button class="p-1" (click)="checkLiquidado(element.idpedido)"><span class="fs-10">Liquidado</span></button>
                                </ng-container>
                                <ng-template #elseTemplate>
                                    <span class="fw-600 text-success">{{ element.pp_arr.total }}</span>
                                </ng-template>
                                                                                
                            </td>
                            <td align="right" mat-footer-cell *matFooterCellDef> {{getTotalCostLiquidado() | number: '.2'}} </td>
                        </ng-container>

                        <ng-container matColumnDef="action_abonado">
                            <th mat-header-cell *matHeaderCellDef class="text-right">Abonado</th>
                            <td mat-cell *matCellDef="let element" align="right">
                                
                                <ng-container *ngIf="dataFiltroAbonar.por === '0'; else elseTemplate">

                                    <!-- comercio -->
                                    <ng-container *ngIf="element.check_pagado === '0' ; else elseTemplate">                                
                                        <button class="p-1" (click)="checkAbonado(element)"><span class="fs-9">Abonado</span></button>
                                    </ng-container>
                                    <ng-template #elseTemplate>
                                        <span class="fw-600 text-success"><i class="fa fa-check"></i></span>
                                    </ng-template>
                                    
                                </ng-container>
                                <ng-template #elseTemplate>
                                    
                                    <!-- repartidor -->
                                    <ng-container *ngIf="element.check_pago_repartidor === '0' ; else elseTemplate">                                
                                        <button class="p-1" (click)="checkAbonadoRepartidor(element.idpedido)"><span class="fs-9">Abonado</span></button>
                                    </ng-container>
                                    <ng-template #elseTemplate>                                        
                                        <span class="fw-600 text-success"><i class="fa fa-check"></i></span>
                                        
                                    </ng-template>

                                </ng-template>
                                                                                    
                                
                            </td>
                            <td mat-footer-cell *matFooterCellDef> </td>
                        </ng-container>
        
                        <tr mat-header-row *matHeaderRowDef="getDisplayColummsAbonado()"></tr>
                        <tr mat-row  *matRowDef="let row; columns: getDisplayColummsAbonado();" [ngClass]="{'bg-row-anulado': row.pwa_delivery_atendido === 1}"></tr>
                        <tr mat-footer-row *matFooterRowDef="getDisplayColummsAbonado()"></tr>
                    </table>
                    <mat-paginator [pageSizeOptions]="[20, 40, 60]" showFirstLastButtons #paginatorAbona></mat-paginator>
                </div>
            </div>
        </mat-tab>


        <!-- comercios -->
        <mat-tab label="Comercios"> 
            <div class="p-3">                       
                <app-comercios></app-comercios>
            </div>
        </mat-tab>        

    </mat-tab-group>
</div>